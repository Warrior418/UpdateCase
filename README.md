# Distributed File Storage System

Система распределенного хранения файлов, реализованная на Go.

## Описание

Система состоит из следующих компонентов:

- **API Сервер** - REST API для загрузки/скачивания файлов с автоматическим разделением на куски
- **Storage Серверы** - серверы хранения кусков файлов  
- **Console Client** - консольное приложение для взаимодействия с системой

## Особенности

- Автоматическое разделение файлов на 6 равных частей
- Равномерное распределение кусков по серверам хранения
- Горизонтальное добавление storage серверов
- SHA256 проверка целостности каждого куска
- Параллельная обработка файлов
- Хранение в памяти для оптимизации производительности
- Потоковая обработка без временных файлов
- Health checks для мониторинга состояния сервисов

## Архитектура

```
┌─────────────────┐    ┌──────────────────────┐    ┌─────────────────────┐
│                 │    │                      │    │                     │
│   Console       │───▶│     API Server       │───▶│  Storage Server 1   │
│   Client        │    │   (Port 8080)        │    │   (Port 8081)       │
│                 │    │                      │    │                     │
└─────────────────┘    │  ┌─────────────────┐ │    └─────────────────────┘
                       │  │ Streaming API   │ │    ┌─────────────────────┐
┌─────────────────┐    │  │ Memory Storage  │ │───▶│  Storage Server 2   │
│                 │    │  │ Health Checks   │ │    │   (Port 8082)       │
│   REST API      │───▶│  │ Load Balancing  │ │    │                     │
│   Clients       │    │  └─────────────────┘ │    └─────────────────────┘
│                 │    │                      │              ...
└─────────────────┘    └──────────────────────┘    ┌─────────────────────┐
                                                   │  Storage Server 6   │
                                                   │   (Port 8086)       │
                                                   │                     │
                                                   └─────────────────────┘
```

## Установка и запуск

### Требования

- Go 1.21+
- Docker и Docker Compose (опционально)

### Быстрый старт

```bash
# Клонируйте репозиторий
git clone https://github.com/Warrior418/UpdateCase.git
cd UpdateCase

# Запуск системы
./start.sh

# Или с Docker Compose
docker-compose up -d
```

## API

### Endpoints

| Метод | Endpoint | Описание |
|-------|----------|----------|
| `POST` | `/api/v1/files` | Загрузка файла |
| `GET` | `/api/v1/files` | Список файлов |
| `GET` | `/api/v1/files/{id}` | Скачивание файла |
| `DELETE` | `/api/v1/files/{id}` | Удаление файла |
| `GET` | `/health` | Проверка состояния |

### Примеры

```bash
# Загрузка файла
curl -X POST -F "file=@test.txt" http://localhost:8080/api/v1/files

# Список файлов
curl http://localhost:8080/api/v1/files

# Скачивание файла
curl -o downloaded.txt http://localhost:8080/api/v1/files/{file-id}

# Проверка состояния
curl http://localhost:8080/health
```

## Структура проекта

```
UpdateCase/
├── cmd/                       # Точки входа приложений
│   ├── api/                  # API сервер
│   │   └── main.go          # Основной сервер
│   └── storage/             # Storage серверы
│       ├── main.go         # Файловое хранение
│       └── memory_server.go # Memory хранение
├── pkg/                      # Основная логика
│   ├── chunking/            # Разделение файлов
│   ├── storage/             # Клиенты и хранилища
│   └── client/              # HTTP клиенты
├── internal/                 # Внутренние пакеты
│   └── config/             # Конфигурация
├── start.sh                 # Скрипт запуска
├── docker-compose.yml       # Docker Compose
├── test.txt                 # Тестовый файл
└── postman_collection.json  # Postman коллекция
```

## Разработка

```bash
# Установка зависимостей
go mod download

# Запуск тестов
go test ./...

# Сборка
go build -o bin/api ./cmd/api/
go build -o bin/storage ./cmd/storage/
```

## Тестирование

```bash
# Запуск тестов
go test ./...

# Тестирование с покрытием
go test -cover ./...
```

## Конфигурация

Основные переменные окружения:

```bash
export API_PORT=8080
export STORAGE_PORT=8081
export MAX_FILE_SIZE=10737418240  # 10 GiB
```

## Алгоритм работы

1. Клиент загружает файл через API
2. API сервер разделяет файл на 6 равных кусков
3. Каждый кусок получает SHA256 хэш для проверки целостности
4. Куски распределяются по storage серверам по round-robin
5. Метаданные файла сохраняются в памяти API сервера
6. При скачивании куски собираются обратно в исходный файл
